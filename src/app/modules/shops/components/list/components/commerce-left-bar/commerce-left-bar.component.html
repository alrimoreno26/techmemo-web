<div class="companies-left-bar relative" [ngClass]="{'sandbox': isSandboxMode}">
    <ng-template [ngIf]="commercesService.loaded$()" [ngIfElse]="elseOr">
        <div class="list-organization-data px-2 pb-3 border-gray-300 border-bottom-1 text-gray-600">
			<span class="p-float-label mt-4 w-full text-gray-600 ">
				<p-treeSelect containerStyleClass="w-full"
                              [options]="organizationsChildrenListTreeNode"
                              [(ngModel)]="selectedOrganizationsChildrenTreeNode"
                              [filterInputAutoFocus]="true"
                              (onNodeSelect)="selectOrganizationChildrenTreeNode($event)"
                              placeholder="{{'app.label_commerce_subordinate' | translate}}"
                              [filter]="true"
                              [disabled]="true">
				</p-treeSelect>
				<label [ngClass]="{'organization-base': !collapseCompaniesListData, 'hidden': collapseCompaniesListData}">{{"app.label_commerce_subordinate" | translate}}</label>
			</span>
        </div>
        <p-listbox #companiesListData
                   [options]="filteredCompaniesListData"
                   [(ngModel)]="selectedCompanyData"
                   [filter]="true"
                   [metaKeySelection]="true"
                   filterBy="socialReason"
                   optionLabel="socialReason"
                   styleClass="w-full border-none bg-white"
                   [ngClass]="{'empty-list-companies': filteredCompaniesListData.length === 0}"
                   (onChange)="selectDataOption()">
            <ng-template pTemplate="filter" let-options>
                <ng-container *ngTemplateOutlet="showOrganizationCompaniesSearchOptions;"></ng-container>
            </ng-template>
            <ng-template let-data pTemplate="item">
                <div class="w-full company-item" [ngClass]="{'active-company-item': data?.cnpj === companyDataInfo?.cnpj}" pTooltip="{{data?.socialReason}}">
                    <div class="flex justify-content-between align-items-center">
                        <div class="flex justify-content-start align-items-center gap-2">
                            <div class="text-sm">
                                <p-avatar label="{{data?.socialReason?.slice(0, 1)}}" size="large" shape="circle"></p-avatar>
                            </div>
                            <div class="text-sm" [ngClass]="{'flex flex-column': !collapseCompaniesListData, 'hidden': collapseCompaniesListData}">
                                <span class="social-reason white-space-nowrap overflow-hidden fadein animation-duration-1000">{{data.socialReason | wrapText:26}}</span>
                                <span class="cnpj white-space-nowrap overflow-hidden fadein animation-duration-1000">{{data.cnpj | cnpj}}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </ng-template>
            <ng-template pTemplate="empty">
                <div class="empty-search-companies text-center">
                    <img alt="empty-search" class="empty_list" src="assets/images/commerce.svg"/>
                    <span class="text-gray-500">{{'primeng.emptyFilterMessage' | translate}}</span>
                </div>
            </ng-template>
        </p-listbox>
        <div class="absolute w-full companies-paginate overflow-hidden">
            <p-paginator [first]="companiesFirstPage" [rows]="companiesSize" [totalRecords]="companiesTotal" (onPageChange)="onCompanyPageChange($event)" [showCurrentPageReport]="!collapseCompaniesListData"
                         currentPageReportTemplate="{first} - {last} de {totalRecords}" [showPageLinks]="false" [showFirstLastIcon]="!collapseCompaniesListData" ></p-paginator>
        </div>
    </ng-template>
    <ng-template #elseOr>
        <div class="flex flex-row mb-1 border-gray-300 border-bottom-1">
            <div class="col-12">
                <p-skeleton height="1rem" styleClass="mb-1" [ngClass]="{'hidden': collapseCompaniesListData}"></p-skeleton>
                <p-skeleton height="3rem" styleClass="mb-2"></p-skeleton>
            </div>
        </div>
        <div class="flex flex-row mt-1 mb-1 border-gray-300 border-bottom-1">
            <div [ngClass]="{'col-10': !collapseCompaniesListData, 'col-12': collapseCompaniesListData}">
                <p-skeleton height="3rem"></p-skeleton>
            </div>
            <div [ngClass]="{'col-2': !collapseCompaniesListData, 'hidden': collapseCompaniesListData}">
                <p-skeleton height="3rem"></p-skeleton>
            </div>
        </div>
        <div class="flex flex-column">
            <div class="col-12 py-0 skeleton-companies-container">
                <p-skeleton *ngFor="let item of skeletonCompaniesItemsArray" height="60px" styleClass="mb-1"></p-skeleton>
            </div>
            <div class="companies-paginate col-12 p-0 mt-2">
                <div class="companies-paginator-all" [ngClass]="{'hidden': collapseCompaniesListData}">
                    <div class="flex align-items-center justify-content-center gap-2 mt-2">
                        <p-skeleton height="30px" width="90px"></p-skeleton>
                        <p-skeleton *ngFor="let item of skeletonCompaniesPaginateItemsArray" height="30px" width="40px"></p-skeleton>

                    </div>
                </div>
                <div class="companies-paginator-small col-12" [ngClass]="{'flex flex-column': collapseCompaniesListData, 'hidden': !collapseCompaniesListData}">
                    <p-skeleton height="30px" styleClass="mb-1"></p-skeleton>
                    <p-skeleton height="30px"></p-skeleton>
                </div>
            </div>
        </div>
    </ng-template>

</div>

<ng-template #showOrganizationCompaniesSearchOptions>
	<div class="search-options flex justify-content-between align-items-center w-full gap-2">
		<div [ngClass]="{'p-inputgroup': !collapseCompaniesListData, 'hidden': collapseCompaniesListData}">
			<span class="p-inputgroup-addon cursor-pointer text-white bg-primary"
				pTooltip="{{'app.orderCompanyBy' | translate}}"
				(click)="opFilter.toggle($event)">
				<i class="mdi mdi-order-alphabetical-ascending"></i>
			</span>
			<p-overlayPanel #opFilter [showCloseIcon]="true" [style]="{width: '300px'}">
				<ng-template pTemplate>
					<div class="w-full py-2">
						<div class="p-fluid grid">
							<div class="field col-12 w-full">
								<span class="filter text-lg font-medium bg-gray-100 p-2 flex w-full">{{'app.orderCompanyBy' | translate}}</span>
							</div>
							<div class="field col-12">
								<span class="p-float-label">
									<p-dropdown inputId="order-field" [options]="orderFields" [(ngModel)]="orderFieldSelected"
										optionLabel="name" [filter]="false" (onChange)="onCompanyOrderChange($event)"/>
									<label>{{'app.field' | translate}}</label>
								</span>
							</div>
							<div class="field col-12">
								<span class="p-float-label">
									<p-dropdown inputId="order-by" [options]="orderBy" [(ngModel)]="orderBySelected"
										optionLabel="name" [filter]="false" (onChange)="onCompanyOrderChange($event)">
										<ng-template pTemplate="selectedItem" [ngIf]="orderBySelected">
												<div class="flex align-items-center gap-2">
													<i [class]="'mdi mdi-' + orderBySelected.icon "></i>
													<div>{{ orderBySelected.name }}</div>
												</div>
										</ng-template>
										<ng-template let-order pTemplate="item">
											<div class="flex align-items-center gap-2">
												<i [class]="'mdi mdi-' + order.icon "></i>
												<div>{{ order.name }}</div>
											</div>
										</ng-template>
									</p-dropdown>
									<label>{{'app.order' | translate}}</label>
								</span>
							</div>
							<div class="field col-12 hidden">
								<span class="p-float-label">
									<p-multiSelect inputId="filter-users" [options]="organizationUsers" [(ngModel)]="filterUsers"
										optionLabel="userName" [filter]="false" (onChange)="filterCompanyData($event)"/>
									<label>{{'app.user' | translate}}</label>
								</span>
							</div>
							<div class="field col-12 hidden">
								<span class="p-float-label">
									<p-calendar inputId="filter-created-date" [(ngModel)]="filterCreatedDate" [showIcon]="true"
										[readonlyInput]="true" [showButtonBar]="true" (onSelect)="filterCompanyData($event)"
										(onClear)="filterCompanyData($event)" (onClearClick)="filterCompanyData($event)"
										dateFormat="dd/mm/yy"></p-calendar>
									<label>{{'app.date' | translate}}</label>
								</span>
							</div>
							<div class="field col-12 hidden">
								<div class="flex flex-column gap-3">
									<button pButton type="button" icon="mdi mdi-filter-off-outline" class="p-button-outlined p-button-secondary"
										label="{{'app.clear' | translate}}" (click)="clearFilter($event)"></button>
									<div class="total-filters bg-gray-100 text-right p-2 font-semibold font-italic">
										{{'app.total' | translate}}: {{this.companiesTotal}} {{'app.companies' | translate}}
									</div>
								</div>
							</div>
						</div>
					</div>
				</ng-template>
			</p-overlayPanel>
			<input type="text" pInputText class="hover:border-primary-color" placeholder="{{'app.search' | translate}}" [(ngModel)]="filterValue"
				(keyup)="filterCompanyData($event)">
		</div>
		<button pButton pRipple
			id="add-company-btn" class="px-2 p-button-sm"
			(click)="showAddCompany(true)"
			icon="mdi mdi-playlist-plus mdi-18px"
			pTooltip="{{'app.addCompany' | translate}}">
		</button>
	</div>
</ng-template>

<ng-template #showMessageDataView let-messageData="messageData">
	<p-messages severity="error">
		<ng-template pTemplate>
			<span class="mdi mdi-alert-circle mdi-24px"></span>
			<div class="ml-2">{{messageData}}</div>
		</ng-template>
	</p-messages>
</ng-template>
