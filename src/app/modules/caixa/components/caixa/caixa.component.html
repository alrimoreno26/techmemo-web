<!--<app-print-nfe [product]="orders" [total]="comandaTotal()"></app-print-nfe>-->
<main class="main_pos p-4 pb-0" appFocus>
    <div class="grid">
        <div class="col-12 shadow-6">
            <div class="flex flex-1 w-full gap-3" style="width: 220px">
                <p-button class="flex-1"
                          [disabled]="pagamento"
                          styleClass="w-full p-button-outlined flex-1 flex-column flex justify-content-center">
                    <i class="mdi mdi-printer text-5xl"></i>
                    <span class="text-lg">(F4) NFC-e</span>
                </p-button>
                <p-button class="flex-1"
                          (onClick)="refreshOrders()"
                          styleClass="w-full p-button-outlined flex-1 flex-column flex justify-content-center">
                    <i class="mdi mdi-refresh text-5xl"></i>
                    <span class="text-lg">(F5) Atualizar</span>
                </p-button>
                <p-button
                    class="flex-1"
                    (onClick)="deleteAll()"
                    [disabled]="pagamento"
                    styleClass="w-full p-button-outlined p-button-danger flex-1 flex-column flex justify-content-center">
                    <i class="mdi mdi-minus-circle-outline text-5xl"></i>
                    <span class="text-lg">(F6) Apagar</span>
                </p-button>
                <p-button
                    class="flex-1"
                    [disabled]="pagamento"
                    styleClass="w-full p-button-outlined flex-1 flex-column flex justify-content-center">
                    <i class="mdi mdi-printer text-5xl"></i>
                    <span class="text-lg">(F7) Cozinha</span>
                </p-button>
                <p-button
                    class="flex-1"
                    [disabled]="pagamento"
                    styleClass="w-full p-button-outlined flex-1 flex-column flex justify-content-center">
                    <i class="mdi mdi-printer text-5xl"></i>
                    <span class="text-lg">(F8) Imprimir</span>
                </p-button>
                <p-button
                    class="flex-1"
                    [disabled]="!canFinalize$"
                    (onClick)="finalizeOrder()"
                    styleClass="w-full p-button-outlined p-button-success flex-1 flex-column flex justify-content-center">
                    <i class="mdi mdi-check-circle-outline text-5xl"></i>
                    <span class="text-lg">(F9) Finalizar</span>
                </p-button>
                <p-button
                    class="flex-1"
                    (onClick)="transferOrders()"
                    [disabled]="pagamento"
                    styleClass="w-full p-button-outlined p-button-warning flex-1 flex-column flex justify-content-center">
                    <i class="mdi mdi-swap-horizontal text-5xl"></i>
                    <span class="text-lg">(F10) Enviar</span>
                </p-button>
                <p-divider [layout]="'vertical'"></p-divider>
                <p-button
                    (onClick)="closeOrders()"
                    class="flex-1"
                    styleClass="w-full p-button-outlined p-button-danger flex-1 flex-column flex justify-content-center">
                    <i class="mdi mdi-close-circle-outline text-5xl"></i>
                    <span class="text-xl">(ESC) Fechar</span>
                </p-button>
            </div>
        </div>
        <div class="bg-white border-round col-12 my-3 pt-0 px-0 shadow-2 sm:col-7 xl:col-7">
            <div class="border-0 col-12 p-0">
                <div class="search-container p-3 gap-2">
                    <i class="pi pi-search"></i>
                    <p-autoComplete styleClass="w-full" appFocus #input (completeMethod)="search($event)"
                                    (input)="searchProducts($event)"
                                    [disabled]="pagamento"
                                    field="name"
                                    [(ngModel)]="selectedItem" [suggestions]="suggestions"></p-autoComplete>
                    <div style="width: 6.5em;">
                        <span class="p-input-icon-left">
                            <i class="pi pi-hashtag"></i>
                            <input class="pl-4" type="number" pInputText [(ngModel)]="selectedItemAmount"
                                   [disabled]="pagamento"/>
                        </span>
                    </div>
                    <div>
                        <p-button
                            class="flex-1"
                            (onClick)="addNewOrderTable()"
                            [disabled]="pagamento"
                            styleClass="w-full p-button-outlined flex-1">
                            <img src="assets/layout/images/comanda.svg" width="28" height="28">
                        </p-button>
                    </div>
                </div>

            </div>
            <div *ngIf="service.selectedEntity$() !== undefined">
                <div class="comanda_list">
                    <p-tabView [(activeIndex)]="activeOrder" (onChange)="refresListProduct()" [scrollable]="true"
                               *ngIf="isArray(service.selectedEntity$()) ">
                        <p-tabPanel *ngFor="let tab of orders"
                                    [header]="getTitleComanda(tab)">
                            <p-table [value]="tab.products || []" [scrollable]="true"
                                     [styleClass]="'p-datatable-sm'">
                                <ng-template pTemplate="header">
                                    <tr>
                                        <th class="custom-th font-bold" alignFrozen="left" pFrozenColumn></th>
                                        <th class="custom-th font-bold">Nome do Produto</th>
                                        <th class="custom-th font-bold">Unit</th>
                                        <th class="custom-th font-bold">Quantia</th>
                                        <th class="custom-th font-bold">Preço</th>
                                        <th class="custom-th font-bold">Valor Adicional</th>
                                        <th class="custom-th font-bold" alignFrozen="right" pFrozenColumn>Preço Total
                                        </th>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="body" let-product>
                                    <tr [ngClass]="{'bg-green-100': isPaid(product)}">
                                        <td class="flex gap-2" pFrozenColumn>
                                            <p-button styleClass="border-round-3xl severity_danger small"
                                                      icon="pi pi-times"
                                                      [disabled]="pagamento || product.amount === product.amountPaid"
                                                      (onClick)="deleteFromOrder(product)">
                                            </p-button>
                                            <p-button styleClass="border-round-3xl severity_info small"
                                                      [disabled]="product.additionals.length === 0 || pagamento || product.amount === product.amountPaid"
                                                      icon="pi pi-search"
                                                      (onClick)="lookAdditional(product)">
                                            </p-button>
                                        </td>
                                        <td class="custom-td" style="min-width: 220px">{{ product.name | wrapText: 25 }}
                                        </td>
                                        <td class="custom-td">
                                            {{ product.amount }}
                                        </td>
                                        <td class="custom-td">{{ product.unit === 'KILO' ? product.peso_liquido : ('-') }}</td>
                                        <td class="custom-td">{{ product.salePrice| currency }}</td>
                                        <td class="custom-td">{{ product.totalAdditionalsValue| currency }}</td>
                                        <td class="custom-td font-bold" alignFrozen="right"
                                            pFrozenColumn>{{ product.soldPerUnits ? ((product.salePrice + product.totalAdditionalsValue) * product.amount | currency) : (product.salePrice | currency) }}
                                        </td>
                                    </tr>
                                </ng-template>
                            </p-table>
                        </p-tabPanel>
                    </p-tabView>
                </div>
                <div class="mt-20 gray-color flex flex-column m-3" *ngIf="service.selectedEntity$() !== null">
                    <div class="flex align-items-center justify-content-between">
                        <h6 class="text-2xl text-gray-600 m-0">Sub-Total Order:</h6>
                        <h6 class="text-3xl text-primary m-0">{{ (service.selectedEntity$()[activeOrder]?.valueToPaid - service.selectedEntity$()[activeOrder]?.valuePaid) | currency }}</h6>
                    </div>
                    <div class="flex align-items-center justify-content-between">
                        <h6 class="text-3xl text-gray-600 m-0">Total ({{ service.selectedEntity$().length }})
                            Orders:</h6>
                        <h6 class="text-5xl text-primary m-0">{{ comandaTotal() | currency }}</h6>
                    </div>
                    <div class="flex gap-3">
                        <div class="flex-1">
                            <p-button styleClass="w-full flex align-items-center justify-content-center p-button-danger p-button-raised"
                                      (onClick)="fecharConta()"
                                      [disabled]="pagamento">
                                <span class="text-3xl">(F11) Fechar Conta</span>
                            </p-button>
                        </div>
                        <div class="flex-1">
                            <p-button styleClass="w-full flex align-items-center justify-content-center p-button-raised"
                                      (onClick)="goToPayment()"
                                      [disabled]="pagamento || comandaTotal() === 0">
                                <span class="text-3xl">(F12) Efectuar Pagemento</span>
                            </p-button>
                        </div>
                    </div>


                </div>
            </div>

        </div>
        <div class="xl:col-5 sm:col-5 col-12">
            <ng-container *ngIf="!pagamento">
                <div class="container_products" (scroll)="onScroll($event)">
                    <div class="grid -mt-3 -ml-3 -mr-3 h-full">
                        <div class="col-12 m-auto">
                            <ng-template [ngIf]="isObject(selectedItem)" [ngIfElse]="blank">
                                <div class="p-2">
                                    <div class="shadow-2 p-2 surface-card border-round">
                                        <div class="relative mb-3">
                                            <img src="assets/layout/images/no-pictures.png" class="w-full"/>
                                        </div>
                                        <div class="flex justify-content-between align-items-center mb-3">
                                            <span
                                                class="text-900 font-medium text-xl">{{ selectedItem.name }}</span>
                                        </div>
                                        <span
                                            class="text-primary text-xl font-bold">{{ selectedItem.salePrice | currency }}
                                            {{ selectedItem.soldPerUnits ? "Unit" : " / " + selectedItem.unitMeasurementName+"("+selectedItem.unitMeasurementCode+")" }}</span>
                                    </div>
                                </div>
                            </ng-template>
                            <ng-template #blank>
                                <img [src]="'assets/images/search.svg'" alt="diamond-layout"/>
                            </ng-template>
                        </div>
                    </div>
                </div>
            </ng-container>
            <ng-container *ngIf="pagamento">
                <app-keypad [totalPayment]="comandaTotal()" (confirmSell)="sellConfirmed($event)"
                            [tableOrderClosed]="oneClosed"
                            (goBack)="goBack($event)"></app-keypad>
            </ng-container>
        </div>
    </div>
</main>
<p-dialog header="Confirmar Peso de Balanço" [(visible)]="visible" [modal]="true" [style]="{ width: '25vw' }"
          [draggable]="false" [resizable]="false">
    <div class="flex justify-content-center mb-3">
        <p-selectButton [options]="weightOptions" [(ngModel)]="value" optionLabel="label"
                        optionValue="value"></p-selectButton>
    </div>
    <div class="text-center flex flex-column justify-content-center align-items-center">
        <p-inputNumber
            inputStyleClass="w-1 border-0 text-7xl text-red-500 font-bold shadow-4 text-center"
            [disabled]="setDisabled()"
            [(ngModel)]="weightScale" inputId="locale-user" [minFractionDigits]="3"></p-inputNumber>
        <small>Peso Kg</small>
    </div>
    <ng-template pTemplate="footer">
        <button pButton pRipple class="p-button-danger flex-1 p-button-outlined" label="Fechar"
                icon="pi pi-fw pi-times"></button>
        <button (click)="confirmWeight()" [disabled]="weightScale === null" pButton pRipple
                class="p-button-primary flex-1 border-round" label="Salvar"
                icon="pi pi-fw pi-check"></button>
    </ng-template>
</p-dialog>
<p-dialog header="Nome do Cliente" [(visible)]="dialogNameCliente" [modal]="true" [style]="{ width: '25vw' }"
          [draggable]="false" [resizable]="false">
        <span class="p-float-label mt-4">
            <input pInputText id="username" [(ngModel)]="clientName"/>
            <label for="username">Nome do Cliente</label>
        </span>
    <ng-template pTemplate="footer">
        <button pButton pRipple class="p-button-danger flex-1 p-button-outlined" label="Fechar"
                (click)="discardNameClient()"
                icon="pi pi-fw pi-times"></button>
        <button (click)="confirmNameClient()" pButton pRipple class="p-button-primary flex-1 border-round"
                label="Adicionar"
                icon="pi pi-fw pi-check"></button>
    </ng-template>
</p-dialog>

<m-cancellation [cancellation]="cancellation" (closed)="closeModalCancellation($event)"></m-cancellation>
<m-cpf-nota [cpfNota]="cpfNota" (closed)="closeModalCpfNota($event)"></m-cpf-nota>
